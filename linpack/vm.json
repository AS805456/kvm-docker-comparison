{
  "description": "Packer template to build a QEMU VM image containing Ubuntu 13.10 (Saucy) Server with Intel Linpack",
  "provisioners": [
    {
       "inline":[
          "echo '\u0025arl ALL=NOPASSWD:ALL' > /tmp/packer",
          "chmod 0440 /tmp/packer",
          "mv /tmp/packer /etc/sudoers.d/",
          "apt-get -y install nfs-common",
          "rm /var/lib/dhcp/*",
          "rm /etc/udev/rules.d/70-persistent-net.rules",
          "mkdir /etc/udev/rules.d/70-persistent-net.rules",
          "rm -rf /dev/.udev/",
          "rm /lib/udev/rules.d/75-persistent-net-generator.rules",
          "echo 'pre-up sleep 2' >> /etc/network/interfaces",
          "exit"
       ],
       "type":"shell"
    },
    {
      "type": "file",
      "source": "bin/",
      "destination": "/bin"
    }
  ],
  "builders": [
    {
      "type": "qemu",
      "output_directory": "vm",
      "boot_command": [
        "<esc><esc><enter><wait>",
        "/install/vmlinuz noapic locale=en_US <wait>",
        "keyboard-configuration/layoutcode=us <wait>",
        "preseed/url=http://10.0.2.2:{{ .HTTPPort }}/arl.seed <wait>",
        "hostname={{ .Name }} <wait>",
        "initrd=/install/initrd.gz quiet -- <enter><wait>"
      ],
      "boot_wait": "4s",
      "disk_size": 10140,
      "headless":false,
      "http_directory": "../common/packer",
      "iso_checksum": "4d1a8b720cdd14b76ed9410c63a00d0e",
      "iso_checksum_type": "md5",
      "iso_url": "http://software.linux.ibm.com/pub/ubuntu/13.10/ubuntu-13.10-server-amd64.iso",
      "name":"saucy-linpack",
      "vm_name":"saucy-linpack",
      "ssh_username": "root",
      "ssh_password": "aust1ntx",
      "ssh_port": 22,
      "ssh_wait_timeout": "10000s",
      "shutdown_command": "echo 'shutdown -P now' > shutdown.sh; echo 'vagrant' | sudo -S sh 'shutdown.sh'",
      "qemuargs":[
         [
            "-display",
            "none"
         ],
         [
            "-m",
            "1024m"
         ]
      ]
    }
  ]
}
